#! /usr/bin/env janetsh

(import sh)

(sh/$ true)

(try (do (sh/$ false) (error "fail") ) ([e] nil))

(when (not= (sh/$$ echo -n hello) "hello")
  (error "fail1"))

(when (not= (sh/$$_ echo hello) "hello")
  (error "fail2"))

(sh/$ echo hello :2> ./err.txt :1>&2)
(when (not= (string (slurp "err.txt")) "hello\n")
 (error "fail3"))

(when (not= (sh/$? sh -c "exit 3") 3)
  (error "fail4"))

(when (not (sh/$?? true))
  (error "fail5"))

(when (sh/$?? false)
  (error "fail6"))

(def j1 (sh/$ sleep "0.1" &))
(def j2 (sh/$ sleep "120" &))
(sh/wait-for-job j1)
(sh/terminate-all-jobs)
(sh/wait-for-job j2)
